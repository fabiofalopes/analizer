Ok temos EntÃ£o a nossa aplicaÃ§Ã£o do controlador a mudar a temperatura muito bem mas a hora continua estÃ¡tica Portanto vamos Neste vÃ­deo perceber como Ã© que podemos modificar este o widget de forma aquele vamos mostrando a hora atualizada dinamicamente vamos comeÃ§ar por mudar isto para passar a ser a hora Real em vez de ser uma hora arte coat ora para isso eu vou comeÃ§ar por fazer uma coisa que jÃ¡ tinha feito para os botÃµes que Ã© extrair isto para um mÃ©todo que vou chamar build ora atual o widget OK e ele criou Aqui Esta funÃ§Ã£o vamos convertÃª-la como fizemos tambÃ©m no outro para uma funÃ§Ã£o de bloco sÃ³ para ficar mais simples de entender e porque vamos precisar de cÃ³digo aqui antes e Vamos alterar o retorno para o widget jÃ¡ tinha explicado no outro vÃ­deo que isto Ã© uma boa prÃ¡tica estes Bills todos que a gente vai criando aqui para nos ajudar a construir o ecrÃ£ devem todos retornar o widget Ok entÃ£o o que nÃ³s queremos Ã© que isto Deixe de ser fixo entÃ£o vamos criar aqui uma variÃ¡vel nÃ£o que vai ser o Day ponto Now ok e isto Ã© sÃ³ para facilitar porque agora vamos eh tÃ­nhamos dos hipÃ³teses nÃ³s podÃ­amos formatar este nÃ£o com este formato mas isto abrigava-nos a instalar aqui um pecados que nÃ£o vale a pena complicar agora e portanto vamos para uma soluÃ§Ã£o mais simples que Ã© basicamente construirmos isto Ã  mÃ£o desta forma ou nÃ£o tem aqui Um Hauer o Mini e o secante Isto vai dar o mesmo efeito e pronto cÃ¡ estÃ¡ temos aqui a hora atual neste momento Ã© 12:45 enquanto estou a gravar este vÃ­deo seu aqui fizer ele vai atualizando Ok falta-lhe ali aquilo podemos fazer ali um pÃ© de Left mas nÃ£o vale a pena sÃ³ agora para mostrar o efeito pronto Isto mostra a hora atual mas apenas quando desenham ecrÃ£ e o problema Ã© que enquanto nÃ³s nÃ£o fizemos o sete seta lÃ¡ estÃ¡ ele nÃ£o vai revivar o ecrÃ£ jÃ¡ sabemos isso do vÃ­deo anterior aliÃ¡s uma coisa engraÃ§ada Ã© que ele se ele fizer aqui um menos como menos me vai fazer atualizar o ecrÃ£ redesenhar o ecrÃ£ ele vai mudar a hora vai nÃ£o sÃ³ mudar a temperatura como da hora para a hora atual e aqui tambÃ©m muda a hora estÃ£o a ver pronto mas o que eu queria era que isto mudasse automaticamente a cada segundo nÃ£o Ã© para dar aquele efeito engraÃ§ado entÃ£o como Ã© que nÃ³s podemos fazer isso bem basicamente voltando aqui nÃ³s vamos ter que ter aqui um processo que segundo manda reduzir o ecrÃ£ como Ã© que vamos fazer isto vamos usar uma classe timer do Dart para o fazer vamos colocar aqui por baixo da temperatura Vamos criar aqui um timer e agora vamos fazer uma coisa que Ã© vamos inicializar o timer numa funÃ§Ã£o especial com os vÃ­deos antectÃ©m que Ã© o initocentos widgets Portanto vamos fazer overwatch state vamos comeÃ§ar por chamar o superintendente e agora vamos aproveitar para iniciar aquilo timer porque esteite sÃ³ Ã© chamado uma vez um momento em que Ã© criado e adicionado ao ecrÃ£ enquanto que o build vai sente chamado vÃ¡rias vezes este Ã© chamado uma Ãºnica vez e portanto Ã© um Ã³timo sÃ­tio para nÃ³s inicializarmos o nosso time Ok entÃ£o o nosso tema vai ficar assim timer igual isto e aqui e aqui vai ser vai estar um bocado de cÃ³digo que vai ser chamado segundo a segunda Ã© o que isto faz portanto este timer falta-me em Portal o cÃ³digo que eu colocar aqui vai ser chamado a cada um segundo E para testarmos isso vamos jÃ¡ criar aqui um dia print acordei assim Uma das uma coisa importante quando usarem o timer Ã© garantir que ele nÃ£o fica permanentemente nisto por exemplo vamos eh desligarmos a aplicaÃ§Ã£o ou sejamos a aplicaÃ§Ã£o entÃ£o podemos tambÃ©m fazer overwatch a um outro mÃ©todo que Ã© o displays onde devemos cancelar o timer antes de fazer o disposto Ok podemos fazer assim desta forma EntÃ£o vamos testar isto cÃ¡ estÃ¡ ele estÃ¡ a acordar de segundo portanto temos neste momento uma forma de executar uma funÃ§Ã£o qualquer um bocado de cÃ³digo qualquer Ã© cada um segundo ora o que que a gente quer escutar ali basicamente queremos que isto refresque o ecrÃ£ redesenho o ecrÃ£ e jÃ¡ tÃ­nhamos visto o que Ã© que Ã© necessÃ¡rio para resenhar o ecrÃ£ Ã© chamar o 7 Portanto vamos chamar o 7 mas nÃ£o vamos colocar aqui nada porque nÃ£o nÃ³s a realidade nÃ£o queremos modificar o estado da aplicaÃ§Ã£o NÃ£o HÃ¡ Nada Para Mudar nÃ³s nÃ£o temos nenhuma variÃ¡vel se nÃ³s guardassemos o tempo atual de uma variÃ¡vel que me parece um bocado e nÃ£o Ã© muito Ãºtil ah eventualmente podÃ­amos aqui atualizar ah nessa variÃ¡vel Mas neste caso nÃ£o vamos precisar de mudar nada no estado queremos apenas garantir que ele vai refrescar ou ecrÃ£ e portanto deixamos Isto assim vazio que serÃ¡ em princÃ­pio o suficiente vamos fazer o teste Tem que reiniciar e cÃ¡ estÃ¡ ele desenhar o ecrÃ£ e Podes ver aqui tambÃ©m a cada um segundo e como de cada vez que desenham vai buscar novamente Ã© hora atual EntÃ£o isto estÃ¡ permanentemente atualizado Ok qual Ã© o problema disto esta soluÃ§Ã£o nÃ£o Ã© espetacular porque nÃ³s basicamente temos aqui dois problemas um Ã© que o nosso controlador tem aqui um timer que apenas Ã© usado por um dos seus widgets Imaginem que isto tinha aqui Ã© no ids aqui envolvidos isto era um testes board para controlar uma casa inteligente e um dos vÃ­deos disseram a hora atual Ora para que Ã© que temos que estar aqui a manter um timer no controlador quando apenas um dos ruÃ­dos timer Mas o problema principal NÃ£o Ã© esse o problema tem a ver que este de 7 tÃ¡ a afetar o controlador state que por sua vez afeta a pÃ¡gina toda do controlador ou seja ele manda redesenhar todos os vÃ­deos que aqui estÃ£o dentro Ora eu apenas preciso resenhar este nÃ£o faz sentido voltar a retirar este nem este nem este nem outros vÃ­deos que aqui estejam por acaso este suÃ­tes SÃ£o relativamente rÃ¡pidos de refrescar mas imagina que havia aqui um widget que era um grÃ¡fico que ia desenhar o grÃ¡fico a partir dos dados que nenhum dos servidor entÃ£o Ã© um bocado chato de segunda segundo Ã© estar a rede de cozinhar o grÃ¡fico e ir ao servidor sobre preciso para ir buscar os dados entÃ£o eu quero isolar ou refrescamento destacr apenas neste widget Isto Ã© um problema muito comum nas arquiteturas por o widget que Ã© nÃ³s queremos isolar apenas os vÃ­deos que devem ser refrescados em cada momento para evitar uma perda de performance de desempenho da aplicaÃ§Ã£o EntÃ£o como Ã© que vamos fazer isso vamos aqui ao nosso build hora atual ET Vamos fazer um reflector e vamos extrair um flutter widget agora finalmente vamos extrair atÃ© agora temos estado a extrair apenas mÃ©todos mas estÃ¡ na altura de colocar isto no seu prÃ³prio widget porque reparem o que eu pretendo agora Ã© fazer isto em vez de todo este Twitter que Ã© o controla a serpente ser resenhar aquele assunto apenas este Twitter vai ser desenhado Mas para eu apenas desenhar eu tenho que o isolar tem que extrair para criar o meu prÃ³prio Widget Ok entÃ£o vamos entÃ£o extrair aqui um widget e vamos chamar hora atual na prÃ³pria no prÃ³prio ficheiro podÃ­amos passar isto para outro cheiro agora para simplificar vou manter aqui neste ficheiro E agora o que Ã© que eu quero fazer primeiro uma vez que este widget vai passar a ser ele controlar o seu prÃ³prio estado e o seu prÃ³prio refrescamento ele a realidade nÃ£o vai ter estado mas Ã© ele que se auto refresca para eu conseguir fazer isso para eu conseguir chamar o 7 dentro dele ele tem que passar a seta de fogo portanto nÃ³s vamos converter isto para aceite ou jÃ¡ tÃ­nhamos visto antes como Ã© que isso podia fazer o segundo passo Ã© ir buscar este cÃ³digo que eu tinha aqui para o controlador e passÃ¡-lo tirar daqui e passar para dentro do que acabei de criar porque todos todos os vÃ­deos todos os States tÃªm estas funÃ§Ãµes inite statespose sÃ³ que agora isto Ã© apenas chamado quando aquele widget especÃ­fico este widget especÃ­fico Ã© inicializado isto Ã© apenas chamado quando esse widget Deixa de ser necessÃ¡rio E isto Ã© apenas chamado quando eu vou desenhar este Twitter especÃ­fico e nÃ£o afeta os outros portanto eu basicamente tornei este comportamento independente dos outros para testarmos isso ah vamos aqui sÃ³ fazer aqui um Diva print a dizer vou desenhar a hora atual portanto JÃ¡ temos um drible 30 a dizer vou desenhar o ecrÃ£ andar aqui todo contente segundo e agora vou desenhar a hora atual e vamos ver o que Ã© que vai acontecer Ok estÃ£o a ver isto continua a funcionar lindamente Mas agora eu jÃ¡ sÃ³ estou a chamar eu vou desenhar a hora atual deixei de desenhar vou desenhar o ecrÃ£ O que quer dizer que este temperatura 25 nÃ£o estÃ¡ a ser resenhado o menos o mais nÃ£o tÃ¡ a ser resenhado e outros ruÃ­dos antes que eu quisesse colocar aqui Ã  volta ou tal grÃ¡fica etc nÃ£o seriam resenhados desta forma consegui isolar este widget ele tem o seu prÃ³prio estado neste caso nÃ£o tem estado mas podia ter lÃ¡ estÃ¡ a variÃ¡veis e etc que ele prÃ³prio controlava e portanto esta deve ser a forma correta de desenhar este tipo de widget externalizandos para que nÃ£o afetem os outros vÃ­deos
