### create_threat_scenarios_20240705-124158_llama3-8b-8192
---
Error: Error code: 400 - {'error': {'message': 'Please reduce the length of the messages or completion.', 'type': 'invalid_request_error', 'param': 'messages', 'code': 'context_length_exceeded'}}
Error code: 400 - {'error': {'message': 'Please reduce the length of the messages or completion.', 'type': 'invalid_request_error', 'param': 'messages', 'code': 'context_length_exceeded'}}
---
### summarize_20240705-124158_llama3-8b-8192
---
# Detecting and mitigating a multi-stage AiTM phishing and BEC campaign

## ONE SENTENCE SUMMARY:
Microsoft Defender Experts uncovered a multi-stage adversary-in-the-middle (AiTM) phishing and business email compromise (BEC) attack that used indirect proxy and session cookie theft to compromise identities and financial services organizations.

## MAIN POINTS:

1. The attack started with a phishing email from a trusted vendor, which was sent with a unique seven-digit code as the subject.
2. The email contained a link to a malicious URL hosted on Canva, which was used to host a fake OneDrive document preview and link to a phishing URL.
3. The phishing page was hosted on a cloud service and used a fake Microsoft sign-in page to steal credentials.
4. The attacker used the stolen credentials to sign in to the target's account and modify the MFA settings to add a new MFA method.
5. The attacker then created an inbox rule to move all incoming emails to the Archive folder and marked all emails as read.
6. The attacker initiated a large-scale phishing campaign involving over 16,000 emails, which were sent to the compromised user's contacts and distribution lists.
7. The attacker used the stolen session cookie to impersonate the user and access email conversations and documents hosted in the cloud.
8. The attack was detected by Microsoft Defender Experts, who used advanced hunting detections and analysis to uncover the attack and identify the compromised users.

## TAKEAWAYS:

1. AiTM phishing attacks are becoming increasingly complex and use indirect proxy and session cookie theft to evade detection.
2. MFA is an essential pillar in identity security and should be implemented and enforced to prevent attacks.
3. Conditional access policies and continuous access evaluation can help detect and prevent suspicious sign-ins.
4. Advanced anti-phishing solutions and continuous monitoring of suspicious activities are necessary to detect and prevent attacks.
5. Microsoft Defender Experts can help detect and mitigate AiTM phishing and BEC attacks using advanced hunting detections and analysis.
---
### extract_extraordinary_claims_20240705-124158_llama3-8b-8192
---
Here are the extraordinary claims extracted from the article:

* The attack used an indirect proxy method, which is a new and evolving technique to evade detection.
* The attackers used a legitimate service, Canva, to host a phishing page.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA method, OneWaySMS, to the compromised user's account.
* The attackers created an inbox rule to move all incoming emails to the Archive folder and mark them as read.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to sign in to the target's account and access email conversations and documents.
* The attackers used a phone-based OTP service to receive a one-time password.
* The attackers added a new MFA policy to sign in with a one-time password sent to an attacker-registered mobile number.
* The attackers used a fake MFA page to request a verification code.
* The attackers used a stolen session cookie to impersonate the user and access email conversations and documents.
* The attackers used a fake sign-in page to request a password.
---
### extract_article_wisdom_20240705-124158_llama3-8b-8192
---
# SUMMARY

* Microsoft Defender Experts uncovered a multi-stage adversary-in-the-middle (AiTM) phishing and business email compromise (BEC) attack against banking and financial services organizations.
* The attack originated from a compromised trusted vendor and transitioned into a series of AiTM attacks and follow-on BEC activity spanning multiple organizations.
* The attack used an AiTM phishing kit developed, maintained, and operated by a threat actor tracked as Storm-1167.

# IDEAS:

* Adversary-in-the-middle (AiTM) phishing attacks are becoming increasingly complex and evolving to evade and even challenge conventional solutions and best practices.
* AiTM attacks use indirect proxy methods to steal session cookies and bypass traditional security controls.
* BEC attacks often involve the use of stolen credentials to sign in to email accounts and send phishing emails to the victim's contacts.
* Microsoft Defender Experts detected suspicious activities related to AiTM phishing attacks and their follow-on activities, such as session cookie theft and attempts to use the stolen cookie to sign into Exchange Online.
* Implementing MFA with conditional access policies can help protect against AiTM phishing attacks.
* Continuous monitoring and hunting for suspicious activities are essential to detecting and mitigating AiTM phishing attacks.

# QUOTES:

* "The attack used an AiTM phishing kit developed, maintained, and operated by a threat actor tracked as Storm-1167."
* "The attackers position themselves between a user and the service to steal credentials and intercept MFA in order to capture the session cookie."
* "The use of indirect proxy in this campaign provided attackers control and flexibility in tailoring the phishing pages to their targets and further their goal of session cookie theft."

# FACTS:

* The attack originated from a compromised trusted vendor.
* The attack used an AiTM phishing kit developed, maintained, and operated by a threat actor tracked as Storm-1167.
* The attack transitioned into a series of AiTM attacks and follow-on BEC activity spanning multiple organizations.
* The attack used indirect proxy methods to steal session cookies and bypass traditional security controls.
* The attack involved the use of stolen credentials to sign in to email accounts and send phishing emails to the victim's contacts.

# REFERENCES:

* Microsoft Defender Experts
* Microsoft 365 Defender
* Microsoft Sentinel
* Azure AD Identity Protection
* Defender for Cloud Apps
* Defender for Office 365
* Microsoft Authenticator
* FIDO2 security keys
* Certificate-based authentication

# RECOMMENDATIONS:

* Implement MFA with conditional access policies.
* Enable continuous access evaluation.
* Invest in advanced anti-phishing solutions.
* Continuously monitor suspicious or anomalous activities.
* Use security defaults as a baseline set of policies to improve identity security posture.
* Enable instant visibility, protection, and governance actions for cloud apps.
* Use connectors for Office 365 and Azure to detect AiTM attacks.
* Use the Microsoft Authenticator, FIDO2 security keys, and certificate-based authentication to enhance identity security.
---
### analyze_tech_impact_20240705-124158_llama3-8b-8192
---
**SUMMARY**
Microsoft Defender Experts uncovered a multi-stage adversary-in-the-middle (AiTM) phishing and business email compromise (BEC) attack against banking and financial services organizations. The attack originated from a compromised trusted vendor and transitioned into a series of AiTM attacks and follow-on BEC activity spanning multiple organizations.

**TECHNOLOGIES USED**
- Adversary-in-the-middle (AiTM) phishing kit
- Cloud services (Canva, Tencent)
- Microsoft sign-in page spoofing
- Multifactor authentication (MFA) bypass
- Session cookie theft
- Stolen session cookie replay attack
- Phishing emails with malicious URLs
- BEC tactics (email manipulation, MFA method modification, inbox rule creation)

**TARGET AUDIENCE**
- Banking and financial services organizations
- Users with access to cloud applications and services

**OUTCOMES**
- Compromised user accounts
- Stolen session cookies
- BEC attacks
- Phishing emails with malicious URLs
- MFA method modification
- Inbox rule creation

**SOCIAL IMPACT**
- Financial fraud
- Identity theft
- Data breaches
- Reputation damage

**ETHICAL CONSIDERATIONS**
- Severity: HIGH
- The attack compromises user identities and financial information, causing significant harm to individuals and organizations.

**SUSTAINABILITY**
- Environmental: N/A
- Economic: N/A
- Social: N/A

**SUMMARY AND RATING**
The attack is a sophisticated and complex threat that compromises user identities and financial information, causing significant harm to individuals and organizations. The severity of the ethical concerns is HIGH. The sustainability of the technology or project is N/A from an environmental, economic, and social perspective. Overall benefit to society: VERY LOW.
---
### extract_wisdom_20240705-124158_llama3-8b-8192
---
# SUMMARY

Microsoft Defender Experts uncovered a multi-stage adversary-in-the-middle (AiTM) phishing and business email compromise (BEC) attack against banking and financial services organizations. The attack originated from a compromised trusted vendor and transitioned into a series of AiTM attacks and follow-on BEC activity spanning multiple organizations.

# IDEAS:

* Adversary-in-the-middle (AiTM) phishing attacks use indirect proxy to evade detection
* AiTM attacks abuse trusted vendor relationships to blend with legitimate email traffic
* Phishing emails from trusted vendors can be used to compromise identities
* MFA is not enough to stop AiTM attacks, as attackers can add new MFA methods to sign in undetected
* Conditional access policies can help detect and prevent AiTM attacks
* Continuous access evaluation can help detect and prevent AiTM attacks
* Advanced anti-phishing solutions can help detect and block malicious emails and websites
* Continuous monitoring of suspicious activities is crucial to detect and prevent AiTM attacks
* AiTM attacks require solutions that leverage signals from multiple sources
* Microsoft 365 Defender uses cross-domain visibility to detect malicious activities related to AiTM
* Defender for Cloud Apps connectors can detect AiTM-related alerts in multiple scenarios
* AiTM attacks can be detected using hunting queries in Microsoft Sentinel

# INSIGHTS:

* AiTM attacks are complex threats that require solutions that leverage signals from multiple sources
* MFA is an essential pillar in identity security, but it is not enough to stop AiTM attacks
* Conditional access policies and continuous access evaluation can help detect and prevent AiTM attacks
* Advanced anti-phishing solutions and continuous monitoring of suspicious activities are crucial to detect and prevent AiTM attacks
* Microsoft 365 Defender and Defender for Cloud Apps can detect AiTM-related alerts in multiple scenarios
* Hunting queries in Microsoft Sentinel can be used to detect AiTM attacks

# QUOTES:

* "The attack achieved the end goal of a typical AiTM phishing attack followed by business email compromise."
* "The use of indirect proxy in this campaign provided attackers control and flexibility in tailoring the phishing pages to their targets."
* "The attackers used a legitimate service Canva for the phishing campaign."
* "The attacker then used the stolen cookie to impersonate the user, circumventing authentication mechanisms of passwords and MFA."
* "The attacker added a new MFA method for the target's account, which was through phone-based one-time password (OTP)."

# HABITS:

* Sleep schedule: Not mentioned
* Reading habits: Not mentioned
* Things they always do: Not mentioned
* Things they always avoid: Not mentioned
* Productivity tips: Not mentioned
* Diet: Not mentioned
* Exercise: Not mentioned

# FACTS:

* The attack originated from a compromised trusted vendor
* The attack used indirect proxy to evade detection
* The attack abused trusted vendor relationships to blend with legitimate email traffic
* The attack used a legitimate service Canva for the phishing campaign
* The attack used a phone-based one-time password (OTP) as a new MFA method
* The attack was detected using Microsoft 365 Defender and Defender for Cloud Apps

# REFERENCES:

* Microsoft Defender Experts for Hunting
* Microsoft 365 Defender
* Defender for Cloud Apps
* Microsoft Sentinel
* Azure AD Identity Protection
* Microsoft Threat Intelligence Blog
* Twitter: @MsftSecIntel

# ONE-SENTENCE TAKEAWAY:

Microsoft Defender Experts uncovered a multi-stage AiTM phishing and BEC attack that used indirect proxy to evade detection and abused trusted vendor relationships to blend with legitimate email traffic.

# RECOMMENDATIONS:

* Implement MFA with conditional access policies
* Enable continuous access evaluation
* Use advanced anti-phishing solutions
* Continuously monitor suspicious activities
* Use hunting queries in Microsoft Sentinel to detect AiTM attacks
* Implement security defaults as a baseline set of policies
* Enable Defender for Cloud Apps connectors to detect AiTM-related alerts
* Use Microsoft 365 Defender to detect malicious activities related to AiTM
---
### analyze_claims_20240705-124158_llama3-8b-8192
---
**ARGUMENT SUMMARY:**
The Microsoft Security Blog reports on a multi-stage AiTM phishing and BEC attack that targeted banking and financial services organizations. The attack used an indirect proxy method, which is a new technique to evade detection. The attackers compromised a trusted vendor's email account and sent phishing emails to the target organizations, leading to a large-scale phishing campaign.

**TRUTH CLAIMS:**

1. **CLAIM:** The attack used an indirect proxy method to evade detection.
	* **CLAIM SUPPORT EVIDENCE:** The blog post provides an in-depth analysis of the attack chain, including the use of an indirect proxy method to host phishing pages on a cloud service.
	* **CLAIM REFUTATION EVIDENCE:** None provided.
2. **CLAIM:** The attackers compromised a trusted vendor's email account and sent phishing emails to the target organizations.
	* **CLAIM SUPPORT EVIDENCE:** The blog post describes the attack chain, including the initial phishing email sent from the compromised vendor's email account.
	* **CLAIM REFUTATION EVIDENCE:** None provided.
3. **CLAIM:** The attack led to a large-scale phishing campaign involving over 16,000 emails.
	* **CLAIM SUPPORT EVIDENCE:** The blog post provides statistics on the number of emails sent as part of the phishing campaign.
	* **CLAIM REFUTATION EVIDENCE:** None provided.

**LOGICAL FALLACIES:**

1. **Appeal to Authority:** The blog post cites Microsoft's threat intelligence community as an authority on the attack.
2. **False Dichotomy:** The blog post presents the attack as a new and complex threat, implying that it is a unique and unprecedented event.

**CLAIM QUALITY SCORE:** B (High)

**LABELS:** Sophisticated, complex, multi-stage attack, BEC, phishing, indirect proxy method, trusted vendor compromise.

**OVERALL SCORE:**

* LOWEST CLAIM SCORE: B (High)
* HIGHEST CLAIM SCORE: B (High)
* AVERAGE CLAIM SCORE: B (High)

**OVERALL ANALYSIS:**
The attack described in this blog post is a sophisticated and complex multi-stage attack that used an indirect proxy method to evade detection. The attackers compromised a trusted vendor's email account and sent phishing emails to the target organizations, leading to a large-scale phishing campaign. The attack highlights the importance of proactive threat hunting and the need for organizations to implement robust security measures to detect and prevent such attacks.
---
### extract_patterns_20240705-124158_llama3-8b-8192
---
Here is the output in Markdown format:

# PATTERNS

* AiTM phishing attacks use indirect proxy instead of reverse proxy
* Attackers abuse trusted vendor relationships to send phishing emails
* Phishing emails are sent with unique seven-digit codes to track targets
* Attackers use legitimate services and brands to host phishing pages
* Fake MFA pages are used to steal session cookies
* Session cookies are replayed to access user accounts
* MFA method modifications are made to evade detection
* Inbox rules are created to move emails to archive folder
* Phishing campaigns are sent to compromised user's contacts
* BEC tactics are used to compromise accounts
* Accounts are compromised through session cookie theft
* MFA is bypassed through session cookie theft
* Conditional access policies are not enabled
* Security defaults are not enabled
* Continuous access evaluation is not implemented
* Advanced anti-phishing solutions are not used
* Suspicious activities are not continuously monitored

# META

* The attack was detected by Microsoft Defender Experts
* The attack used a Storm-1167 AiTM kit
* The attack was launched from a compromised trusted vendor
* The attack used a fake MFA page to steal session cookies
* The attack used a session replay attack to access user accounts
* The attack used a BEC campaign to compromise accounts
* The attack was detected through Microsoft 365 Defender
* The attack was analyzed by Microsoft Defender Experts

# ANALYSIS

The attack used a multi-stage approach to compromise user accounts, starting with a phishing email from a trusted vendor, followed by a fake MFA page to steal session cookies, and finally a session replay attack to access user accounts. The attack also used a BEC campaign to compromise accounts and evade detection.

# BEST 5

* The attack used a unique seven-digit code to track targets
* The attack used a fake MFA page to steal session cookies
* The attack used a session replay attack to access user accounts
* The attack used a BEC campaign to compromise accounts
* The attack was detected through Microsoft 365 Defender

# ADVICE FOR BUILDERS

* Enable conditional access policies to evaluate sign-in requests
* Implement continuous access evaluation to monitor suspicious activities
* Use advanced anti-phishing solutions to detect and block malicious emails and links
* Continuously monitor suspicious or anomalous activities
* Implement security defaults to improve identity security posture
* Enable MFA to prevent session cookie theft
* Use legitimate services and brands to host phishing pages
* Monitor and analyze suspicious activities to detect and prevent attacks
---
### extract_insights_20240705-124158_llama3-8b-8192
---
Here are the insights in 15-word bullet points:

• AiTM phishing attacks abuse trusted vendor relationships to blend with legitimate email traffic.
• Attackers use indirect proxy method to host phishing pages on cloud services.
• Fake MFA pages are used to steal session cookies and bypass authentication.
• Stolen session cookies are replayed to access cloud applications and perform BEC attacks.
• BEC tactics include monitoring victim's mailbox, deleting undelivered emails, and responding to queries.
• Microsoft Defender Experts detected and responded to the attack, revoking compromised user's session cookie.
• Implementing MFA with conditional access policies and continuous access evaluation can help prevent AiTM attacks.
• Advanced anti-phishing solutions and continuous monitoring of suspicious activities are essential for detection and prevention.
• AiTM phishing attacks require solutions that leverage signals from multiple sources, including cross-domain visibility.
• Microsoft 365 Defender uses its cross-domain visibility to detect malicious activities related to AiTM.
• Defender for Cloud Apps connectors detect AiTM-related alerts in multiple scenarios, including stolen session cookie use.
• Microsoft Sentinel customers can use analytic templates and hunting content to find BEC-related activities.
• Continuous improvement and proactive threat hunting are crucial for detecting and mitigating AiTM attacks.
---
### create_summary_20240705-124158_llama3-8b-8192
---
# Detecting and mitigating a multi-stage AiTM phishing and BEC campaign

## ONE SENTENCE SUMMARY:
Microsoft Defender Experts uncovered a multi-stage adversary-in-the-middle (AiTM) phishing and business email compromise (BEC) attack that used indirect proxy and session cookie theft to compromise identities and financial services organizations.

## MAIN POINTS:

1. The attack started with a phishing email from a trusted vendor, which was sent with a unique seven-digit code as the subject.
2. The email contained a link to a malicious URL hosted on Canva, which was used to host a fake OneDrive document preview and link to a phishing URL.
3. The phishing page was hosted on a Tencent cloud platform and spoofed a Microsoft sign-in page, requesting the target's password.
4. After the target provided the password, the attacker used the credentials in an authentication session created on the target website.
5. The attacker then used the stolen session cookie to sign in with the stolen cookie after a few hours from an IP address based in the United States.
6. The attacker added a new MFA method for the target's account, which was through phone-based one-time password (OTP), and created an Inbox rule to move all incoming emails to the Archive folder and mark them as read.
7. The attacker initiated a large-scale phishing campaign involving more than 16,000 emails with a slightly modified Canva URL.
8. The attack used indirect proxy and session cookie theft to compromise identities and financial services organizations.

## TAKEAWAYS:

1. AiTM phishing attacks are complex threats that require solutions that leverage signals from multiple sources.
2. MFA is an essential pillar in identity security and highly effective at stopping a wide variety of threats.
3. Implementing security defaults and enabling conditional access policies can help protect against AiTM phishing attacks.
4. Continuous monitoring and hunting for suspicious or anomalous activities are crucial in detecting and mitigating AiTM phishing attacks.
5. Microsoft 365 Defender uses its cross-domain visibility to detect malicious activities related to AiTM, such as session cookie theft and attempts to use stolen cookies for signing in.
---
### analyze_incident_20240705-124158_llama3-8b-8192
---
Here is the extracted information in the requested format:

**Attack Date:** Not specified

**Summary:** A multi-stage adversary-in-the-middle (AiTM) phishing and business email compromise (BEC) attack was discovered, which used an indirect proxy method to steal session cookies and compromise identities.

**Key Details:**

* **Attack Type:** AiTM phishing and BEC
* **Vulnerable Component:** Session cookies
* **Attacker Information:**
	+ Name/Organization: Storm-1167
	+ Country of Origin: Not specified
* **Target Information:**
	+ Name: Multiple banking and financial services organizations
	+ Country: Not specified
	+ Size: Large enterprise
	+ Industry: Financial services

**Incident Details:**

* **CVE's:** Not specified
* **Accounts Compromised:** Not specified
* **Business Impact:** Operational disruption
* **Impact Explanation:** The attack allowed the attackers to steal session cookies and compromise identities, enabling them to access cloud applications and perform business email compromise attacks.
* **Root Cause:** Unpatched software

**Analysis & Recommendations:**

* **MITRE ATT&CK Analysis:** T1557, T1111
* **Atomic Red Team Atomics:** Not specified
* **Remediation:**
	+ Recommendation: Implement MFA and conditional access policies
	+ Action Plan: 1. Update software, 2. Train staff
* **Lessons Learned:** Proactively hunting for and quickly responding to threats is essential in securing organization networks, as it provides an added layer to other security remediations and can help address areas of defense evasion.

**Mitigation and Protection Guidance:**

* Implement MFA and conditional access policies
* Use security defaults as a baseline set of policies
* Enable continuous access evaluation
* Invest in advanced anti-phishing solutions
* Continuously monitor suspicious or anomalous activities

**Hunting Queries:**

* Microsoft Sentinel: TI Matching Analytics, Sign-ins From VPS providers
---
### extract_ideas_20240705-124158_llama3-8b-8192
---
Here are the 15-word bullet points that capture the most important ideas from the input:

* Adversary-in-the-middle (AiTM) phishing attacks use indirect proxy to evade detection.
* AiTM attacks compromise identities and enable business email compromise (BEC) activity.
* BEC attacks use stolen session cookies to access cloud applications.
* Microsoft Defender Experts detected and mitigated a multi-stage AiTM phishing and BEC campaign.
* The attack used a Storm-1167 AiTM kit and targeted banking and financial services organizations.
* The attackers compromised a trusted vendor and used the vendor's email to send phishing emails.
* The phishing emails used a fake OneDrive document preview and linked to a malicious URL.
* The malicious URL hosted a phishing page that spoofed a Microsoft sign-in page.
* The attackers used the stolen credentials to sign in to the target's account and access email conversations and documents.
* The attackers added a new MFA method to the target's account and used a phone-based OTP service.
* The attackers created an inbox rule to move incoming emails to the Archive folder and marked all emails as read.
* The attackers initiated a large-scale phishing campaign involving over 16,000 emails.
* The attackers used a combination of tactics, techniques, and procedures (TTPs) to evade detection and persistence.
* Microsoft Defender Experts used advanced hunting detections and rapid response to contain the attack.
* The attack highlights the importance of proactive threat hunting and comprehensive defenses against AiTM and BEC threats.
---
### extract_main_idea_20240705-124158_llama3-8b-8192
---
**MAIN IDEA**
Detecting and mitigating a multi-stage AiTM phishing and BEC campaign requires a comprehensive approach that includes implementing security controls like MFA, conditional access policies, and continuous monitoring of suspicious activities.

**MAIN RECOMMENDATION**
Organizations should implement security defaults, enable conditional access policies, and continuously monitor suspicious activities to detect and mitigate multi-stage AiTM phishing and BEC campaigns.
---
